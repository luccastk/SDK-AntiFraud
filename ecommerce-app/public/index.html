<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDK AntiFraud - Demonstra√ß√£o</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            word-wrap: break-word;
            word-break: break-all;
        }
        .success { border-left: 4px solid #28a745; }
        .warning { border-left: 4px solid #ffc107; }
        .danger { border-left: 4px solid #dc3545; }
        .info { border-left: 4px solid #17a2b8; }
        
        .expand-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            margin-top: 10px;
        }
        
        .expand-btn:hover {
            background: #5a6268;
        }
        
        .detailed-result {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 3px;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ°Ô∏è SDK AntiFraud - Demonstra√ß√£o</h1>
        
        <div class="section">
            <h3>üìä Coleta de Fingerprints</h3>
            <p>Clique nos bot√µes abaixo para coletar diferentes tipos de fingerprints:</p>
            
            <button onclick="collectDeviceFingerprint()">Coletar Device Fingerprint</button>
            <button onclick="collectBehaviorFingerprint()">Coletar Behavior Fingerprint</button>
            <button onclick="collectCompleteFingerprint()">Coletar Fingerprint Completo</button>
            
            <div id="fingerprintResult" class="result" style="display: none;"></div>
        </div>

        <div class="section">
            <h3>üîç Verifica√ß√£o de IP</h3>
            <p>Teste a verifica√ß√£o b√°sica de IP:</p>
            
            <button onclick="verifyIp()">Verificar IP</button>
            
            <div id="ipResult" class="result" style="display: none;"></div>
        </div>

        <div class="section">
            <h3>üõ°Ô∏è Verifica√ß√£o Avan√ßada</h3>
            <p>Teste a verifica√ß√£o completa com fingerprints:</p>
            
            <button onclick="verifyAdvanced()">Verifica√ß√£o Avan√ßada</button>
            
            <div id="advancedResult" class="result" style="display: none;"></div>
        </div>

        <div class="section">
            <h3>üìà Estat√≠sticas da Sess√£o</h3>
            <p>Monitore as intera√ß√µes em tempo real:</p>
            
            <div id="stats" class="result info">
                <div>Movimentos do Mouse: <span id="mouseMovements">0</span></div>
                <div>Teclas Pressionadas: <span id="keystrokes">0</span></div>
                <div>Eventos de Scroll: <span id="scrollEvents">0</span></div>
                <div>Cliques: <span id="clickEvents">0</span></div>
                <div>Dura√ß√£o da Sess√£o: <span id="sessionDuration">0</span>ms</div>
            </div>
        </div>
    </div>

    <script>
        // Simula√ß√£o do SDK AntiFraud (em produ√ß√£o seria importado)
        class FingerprintCollector {
            constructor() {
                this.sessionId = 'session_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
                this.startTime = Date.now();
                this.behaviorData = {
                    mouseMovements: 0,
                    keystrokes: 0,
                    scrollEvents: 0,
                    clickEvents: 0,
                    focusEvents: 0,
                    sessionDuration: 0,
                    pageLoadTime: performance.now(),
                    referrer: document.referrer,
                    timestamp: Date.now()
                };
                this.initializeBehaviorTracking();
            }

            initializeBehaviorTracking() {
                document.addEventListener('mousemove', () => {
                    this.behaviorData.mouseMovements++;
                    document.getElementById('mouseMovements').textContent = this.behaviorData.mouseMovements;
                });

                document.addEventListener('keydown', () => {
                    this.behaviorData.keystrokes++;
                    document.getElementById('keystrokes').textContent = this.behaviorData.keystrokes;
                });

                document.addEventListener('scroll', () => {
                    this.behaviorData.scrollEvents++;
                    document.getElementById('scrollEvents').textContent = this.behaviorData.scrollEvents;
                });

                document.addEventListener('click', () => {
                    this.behaviorData.clickEvents++;
                    document.getElementById('clickEvents').textContent = this.behaviorData.clickEvents;
                });

                setInterval(() => {
                    this.behaviorData.sessionDuration = Date.now() - this.startTime;
                    document.getElementById('sessionDuration').textContent = this.behaviorData.sessionDuration;
                }, 1000);
            }

            collectDeviceFingerprint() {
                return {
                    userAgent: navigator.userAgent,
                    language: navigator.language,
                    platform: navigator.platform,
                    screenResolution: `${screen.width}x${screen.height}`,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    colorDepth: screen.colorDepth,
                    pixelRatio: window.devicePixelRatio,
                    hardwareConcurrency: navigator.hardwareConcurrency || 0,
                    maxTouchPoints: navigator.maxTouchPoints || 0,
                    cookieEnabled: navigator.cookieEnabled,
                    doNotTrack: navigator.doNotTrack,
                    plugins: Array.from(navigator.plugins).map(plugin => plugin.name),
                    fonts: this.getFontFingerprint(),
                    canvas: this.getCanvasFingerprint(),
                    webgl: this.getWebGLFingerprint()
                };
            }

            collectBehaviorFingerprint() {
                this.behaviorData.sessionDuration = Date.now() - this.startTime;
                this.behaviorData.timestamp = Date.now();
                return { ...this.behaviorData };
            }

            collectCompleteFingerprint() {
                return {
                    device: this.collectDeviceFingerprint(),
                    behavior: this.collectBehaviorFingerprint(),
                    network: { ip: '' },
                    sessionId: this.sessionId
                };
            }

            getCanvasFingerprint() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                if (!ctx) return '';
                
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillStyle = '#f60';
                ctx.fillRect(125, 1, 62, 20);
                ctx.fillStyle = '#069';
                ctx.fillText('AntiFraud SDK', 2, 15);
                return canvas.toDataURL();
            }

            getWebGLFingerprint() {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (!gl) return '';
                
                const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                if (!debugInfo) return '';
                
                return gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
            }

            getFontFingerprint() {
                // Vers√£o simplificada para demonstra√ß√£o
                return ['Arial', 'Times New Roman', 'Helvetica'];
            }
        }

        const collector = new FingerprintCollector();

        function showResult(elementId, data, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${type}`;
            
            // Truncar dados muito longos para melhor visualiza√ß√£o
            const truncatedData = truncateLongStrings(data);
            element.textContent = JSON.stringify(truncatedData, null, 2);
        }

        function truncateLongStrings(obj, maxLength = 100) {
            if (typeof obj === 'string' && obj.length > maxLength) {
                return obj.substring(0, maxLength) + '... (truncated)';
            }
            
            if (Array.isArray(obj)) {
                return obj.map(item => truncateLongStrings(item, maxLength));
            }
            
            if (obj && typeof obj === 'object') {
                const result = {};
                for (const [key, value] of Object.entries(obj)) {
                    result[key] = truncateLongStrings(value, maxLength);
                }
                return result;
            }
            
            return obj;
        }

        function collectDeviceFingerprint() {
            const fingerprint = collector.collectDeviceFingerprint();
            showResult('fingerprintResult', fingerprint, 'info');
        }

        function collectBehaviorFingerprint() {
            const fingerprint = collector.collectBehaviorFingerprint();
            showResult('fingerprintResult', fingerprint, 'info');
        }

        function collectCompleteFingerprint() {
            const fingerprint = collector.collectCompleteFingerprint();
            showResult('fingerprintResult', fingerprint, 'success');
        }

        async function verifyIp() {
            try {
                const response = await fetch('/api/verify-ip');
                const result = await response.json();
                showCompactResult('ipResult', result, result.success ? 'success' : 'danger');
            } catch (error) {
                showResult('ipResult', { error: error.message }, 'danger');
            }
        }

        async function verifyAdvanced() {
            try {
                const response = await fetch('/checkout-advanced');
                const result = await response.json();
                
                let type = 'info';
                if (result.error) type = 'danger';
                else if (result.message && result.message.includes('revis√£o')) type = 'warning';
                else if (result.message && result.message.includes('aprovado')) type = 'success';
                
                // Mostrar resultado de forma mais compacta
                showCompactResult('advancedResult', result, type);
            } catch (error) {
                showResult('advancedResult', { error: error.message }, 'danger');
            }
        }

        function showCompactResult(elementId, data, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${type}`;
            
            // Formata√ß√£o mais compacta para resultados de verifica√ß√£o
            if (data.verification) {
                const verification = data.verification;
                const summary = {
                    status: verification.status,
                    riskScore: verification.riskScore,
                    reasons: verification.reasons,
                    message: data.message || data.error
                };
                
                // Criar HTML com bot√£o de expandir
                const summaryJson = JSON.stringify(summary, null, 2);
                const fullJson = JSON.stringify(data, null, 2);
                const uniqueId = elementId + '_' + Date.now();
                
                element.innerHTML = `
                    <div>${summaryJson}</div>
                    <button class="expand-btn" onclick="toggleDetails('${uniqueId}')">Ver Detalhes Completos</button>
                    <div id="${uniqueId}" class="detailed-result">${fullJson}</div>
                `;
            } else {
                element.textContent = JSON.stringify(data, null, 2);
            }
        }

        function toggleDetails(elementId) {
            const element = document.getElementById(elementId);
            const button = element.previousElementSibling;
            
            if (element.style.display === 'none' || element.style.display === '') {
                element.style.display = 'block';
                button.textContent = 'Ocultar Detalhes';
            } else {
                element.style.display = 'none';
                button.textContent = 'Ver Detalhes Completos';
            }
        }
    </script>
</body>
</html>
